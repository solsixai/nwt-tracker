<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width, initial-scale=1, viewport-fit=cover">

<title>NWT 5-Year Journey</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#4a90e2">

<!-- iOS -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="NWT Journey">

<style>
:root {
  --primary:#4a90e2;
  --bg:#f4f7f6;
  --card:#ffffff;
  --text:#222;
}
body.dark {
  --bg:#121212;
  --card:#1e1e1e;
  --text:#eee;
}

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
}

header{
  position:sticky;
  top:0;
  background:var(--primary);
  color:white;
  padding:14px;
  text-align:center;
  font-weight:600;
  z-index:10;
}

.container{
  max-width:520px;
  margin:auto;
  padding:15px;
}

.card{
  background:var(--card);
  border-radius:14px;
  padding:15px;
  margin-bottom:15px;
  box-shadow:0 4px 15px rgba(0,0,0,.08);
}

.progress-bar{
  height:8px;
  background:#ddd;
  border-radius:10px;
  overflow:hidden;
}
.progress{
  height:100%;
  background:var(--primary);
  width:0%;
}

button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:10px;
  font-size:16px;
  margin-top:10px;
  cursor:pointer;
}
.primary{ background:var(--primary); color:white; }
.secondary{ background:#666; color:white; }

textarea{
  width:100%;
  height:90px;
  border-radius:10px;
  padding:10px;
  font-size:15px;
}

.small{
  font-size:.85em;
  opacity:.7;
  text-align:center;
}
</style>
</head>

<body>

<header>
üìñ NWT 5-Year Journey
</header>

<div class="container">

<div class="card">
  <div id="progressInfo"></div>
  <div class="progress-bar">
    <div class="progress" id="progressBar"></div>
  </div>
  <div class="small">üî• Streak: <span id="streak">0</span> days</div>
</div>

<div class="card">
<strong>Today‚Äôs Reading</strong><br>
<span id="todayReading"></span>
</div>

<div class="card">
<label><strong>Meditation</strong></label>
<textarea id="dailyLog" placeholder="What did you learn today?"></textarea>
<button class="primary" onclick="completeDay()">Complete Today ‚≠ê</button>
</div>

<div class="card">
<button class="secondary" onclick="toggleDark()">üåô Toggle Dark Mode</button>
<button class="secondary" onclick="backupData()">‚¨á Backup</button>
<button class="secondary" onclick="document.getElementById('importFile').click()">‚¨Ü Import</button>
<input type="file" id="importFile" hidden accept=".json" onchange="importData(event)">
</div>

<button id="installBtn" class="primary" style="display:none">
Install App üì≤
</button>

</div>

<script>
// ===== CONSTANTS =====
const TOTAL_CHAPTERS=1189;
const TOTAL_DAYS=1825;

// ===== STREAK =====
function updateStreak(){
  let last=localStorage.getItem("lastDate");
  let today=new Date().toDateString();
  let streak=Number(localStorage.getItem("streak")||0);

  if(last===today) return;
  if(last===new Date(Date.now()-86400000).toDateString()){
    streak++;
  } else {
    streak=1;
  }
  localStorage.setItem("streak",streak);
  localStorage.setItem("lastDate",today);
  document.getElementById("streak").innerText=streak;
}

// ===== DARK MODE =====
function toggleDark(){
  document.body.classList.toggle("dark");
  localStorage.setItem("dark",document.body.classList.contains("dark"));
}

// ===== COMPLETE =====
function completeDay(){
  updateStreak();
  let day=Number(localStorage.getItem("currentDay")||1);
  localStorage.setItem("currentDay",day+1);
  updateDisplay();
}

// ===== DISPLAY =====
function updateDisplay(){
  let day=Number(localStorage.getItem("currentDay")||1);
  document.getElementById("progressInfo").innerText=
  `Day ${day} of ${TOTAL_DAYS}`;

  document.getElementById("progressBar").style.width=
  `${(day/TOTAL_DAYS)*100}%`;
}

if(localStorage.getItem("dark")==="true"){
  document.body.classList.add("dark");
}

updateDisplay();
</script>

<script>
// INSTALL PROMPT
let deferredPrompt;
window.addEventListener("beforeinstallprompt",e=>{
  e.preventDefault();
  deferredPrompt=e;
  installBtn.style.display="block";
});
installBtn.onclick=()=>{
  deferredPrompt.prompt();
};
</script>

<script>
// SERVICE WORKER
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>