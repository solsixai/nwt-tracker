<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>NWT 5-Year Journey</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#4a90e2">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<style>
:root{
  --primary:#4a90e2;
  --bg:#f4f7f6;
  --card:#ffffff;
  --text:#222;
}
body.dark{
  --bg:#121212;
  --card:#1e1e1e;
  --text:#eee;
}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
  background:var(--bg);
  color:var(--text);
}
header{
  background:var(--primary);
  color:white;
  padding:14px;
  text-align:center;
  font-weight:600;
}
.container{
  max-width:520px;
  margin:auto;
  padding:15px;
}
.card{
  background:var(--card);
  border-radius:14px;
  padding:15px;
  margin-bottom:15px;
  box-shadow:0 4px 15px rgba(0,0,0,.1);
}
.progress-bar{
  height:8px;
  background:#ccc;
  border-radius:10px;
  overflow:hidden;
}
.progress{
  height:100%;
  background:var(--primary);
}
button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:10px;
  font-size:16px;
  margin-top:10px;
}
.primary{ background:var(--primary); color:white; }
.secondary{ background:#666; color:white; }
textarea{
  width:100%;
  height:90px;
  border-radius:10px;
  padding:10px;
}
.small{
  font-size:.85em;
  opacity:.75;
}
</style>
</head>

<body>

<header>üìñ NWT 5-Year Journey</header>

<div class="container">

<div class="card">
  <div id="progressInfo"></div>
  <div class="progress-bar">
    <div class="progress" id="progressBar"></div>
  </div>
  <div class="small">üî• Streak: <span id="streak">0</span> days</div>
</div>

<div class="card">
  <strong>Today‚Äôs Scripture</strong><br>
  <span id="todayReading"></span>
</div>

<div class="card">
  <strong>üìù Daily Reflection</strong>
  <textarea id="note" placeholder="What did you learn today?"></textarea>
  <button class="primary" onclick="completeToday()">Save Reflection ‚≠ê</button>
</div>

<div class="card">
  <strong>üìò Previous Reflections</strong>
  <div id="notesHistory" class="small"></div>
</div>

<div class="card">
  <button class="secondary" onclick="toggleDark()">üåô Toggle Dark Mode</button>
  <button class="secondary" onclick="backup()">‚¨á Backup</button>
  <button class="secondary" onclick="document.getElementById('file').click()">‚¨Ü Import</button>
  <input id="file" type="file" hidden accept=".json" onchange="importData(event)">
</div>

<button id="installBtn" class="primary" style="display:none">
Install App üì≤
</button>

</div>

<script>
/* ===== CONFIG ===== */
const START_DATE = new Date("2026-01-01");
const TOTAL_CHAPTERS = 1189;
const TOTAL_DAYS = 1825;

/* ===== BIBLE ===== */
const bibleBooks = [
 ["Genesis",50],["Exodus",40],["Leviticus",27],["Numbers",36],
 ["Deuteronomy",34],["Joshua",24],["Judges",21],["Ruth",4],
 ["1 Samuel",31],["2 Samuel",24],["1 Kings",22],["2 Kings",25],
 ["1 Chronicles",29],["2 Chronicles",36],["Ezra",10],["Nehemiah",13],
 ["Esther",10],["Job",42],["Psalms",150],["Proverbs",31],
 ["Ecclesiastes",12],["Song of Solomon",8],["Isaiah",66],
 ["Jeremiah",52],["Lamentations",5],["Ezekiel",48],["Daniel",12],
 ["Hosea",14],["Joel",3],["Amos",9],["Obadiah",1],["Jonah",4],
 ["Micah",7],["Nahum",3],["Habakkuk",3],["Zephaniah",3],
 ["Haggai",2],["Zechariah",14],["Malachi",4],
 ["Matthew",28],["Mark",16],["Luke",24],["John",21],
 ["Acts",28],["Romans",16],["1 Corinthians",16],["2 Corinthians",13],
 ["Galatians",6],["Ephesians",6],["Philippians",4],["Colossians",4],
 ["1 Thessalonians",5],["2 Thessalonians",3],["1 Timothy",6],
 ["2 Timothy",4],["Titus",3],["Philemon",1],["Hebrews",13],
 ["James",5],["1 Peter",5],["2 Peter",3],
 ["1 John",5],["2 John",1],["3 John",1],["Jude",1],["Revelation",22]
];

function chapterToBook(ch){
  let count=0;
  for(let [b,c] of bibleBooks){
    if(ch<=count+c) return `${b} ${ch-count}`;
    count+=c;
  }
  return "Finished üéâ";
}

/* ===== DATE LOGIC ===== */
function getDayNumber(){
  return Math.floor((new Date()-START_DATE)/86400000)+1;
}

function getTodayReading(){
  const d=getDayNumber();
  const s=Math.floor((d-1)*(TOTAL_CHAPTERS/TOTAL_DAYS))+1;
  const e=Math.floor(d*(TOTAL_CHAPTERS/TOTAL_DAYS))+1;
  if(s>TOTAL_CHAPTERS) return "Bible Completed üéâ";
  return s===e ? chapterToBook(s) : `${chapterToBook(s)} ‚Äì ${chapterToBook(e)}`;
}

/* ===== STREAK ===== */
function updateStreak(){
  const t=new Date().toDateString();
  let l=localStorage.getItem("last");
  let s=Number(localStorage.getItem("streak")||0);
  if(l===t) return;
  if(l===new Date(Date.now()-86400000).toDateString()) s++;
  else s=1;
  localStorage.setItem("last",t);
  localStorage.setItem("streak",s);
}

/* ===== NOTES ===== */
function loadTodayNote(){
  document.getElementById("note").value =
    localStorage.getItem("note-"+getDayNumber()) || "";
}

function renderNotes(){
  let html="";
  for(let i=getDayNumber(); i>0 && i>getDayNumber()-7; i--){
    const n=localStorage.getItem("note-"+i);
    if(n) html+=`<p><strong>Day ${i}:</strong><br>${n}</p>`;
  }
  document.getElementById("notesHistory").innerHTML =
    html || "No reflections yet.";
}

/* ===== ACTIONS ===== */
function completeToday(){
  updateStreak();
  localStorage.setItem("note-"+getDayNumber(),
    document.getElementById("note").value);
  renderNotes();
}

function toggleDark(){
  document.body.classList.toggle("dark");
  localStorage.setItem("dark",document.body.classList.contains("dark"));
}

function backup(){
  const data={...localStorage};
  const blob=new Blob([JSON.stringify(data)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="nwt-backup.json";
  a.click();
}

function importData(e){
  const r=new FileReader();
  r.onload=()=>{
    const d=JSON.parse(r.result);
    for(let k in d) localStorage.setItem(k,d[k]);
    init();
  };
  r.readAsText(e.target.files[0]);
}

/* ===== UI ===== */
function init(){
  document.getElementById("todayReading").innerText=getTodayReading();
  document.getElementById("progressInfo").innerText=
    `Day ${getDayNumber()} of ${TOTAL_DAYS}`;
  document.getElementById("progressBar").style.width=
    `${(getDayNumber()/TOTAL_DAYS)*100}%`;
  document.getElementById("streak").innerText=
    localStorage.getItem("streak")||0;
  loadTodayNote();
  renderNotes();
}

if(localStorage.getItem("dark")==="true")
  document.body.classList.add("dark");

init();
</script>

<script>
let deferredPrompt;
window.addEventListener("beforeinstallprompt",e=>{
  e.preventDefault();
  deferredPrompt=e;
  installBtn.style.display="block";
});
installBtn.onclick=()=>deferredPrompt.prompt();
</script>

<script>
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>